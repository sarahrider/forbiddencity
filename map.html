<!DOCTYPE html>
<html>
<head>
<title>Forbidden City Map in Leaflet</title>
<!-- Sources:
	W3Schools HTML Tutorial: https://www.w3schools.com/html/
-->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet-search@3.0.10/dist/leaflet-search.min.css">

<script src="https://unpkg.com/leaflet-search@3.0.10/dist/leaflet-search.min.js"></script>
          

<!-- Load GeoJSON File -->

<script src="fc_map_data.js"></script>

<!-- Add a CSS snippet to set the dimensions of the map area -->
<style>
#map_div { 
    height: 500px;
    width: 1000px;
}
.info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,1);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}

.legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.9;
    color: white;
}
</style>

</head>
<body>

<h1>Forbidden City Map in Leaflet</h1>

<!-- Add a div container for the map in the body of the HTML -->
<div id="map_div"></div>

<!-- Insert a JavaScript snippet and create a map -->
<script>

 var mymap = L.map('map_div').setView([39.91873473, 116.390689], 15);

 // Add basemap tiles to the map, using Open Street Maps (OSM)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(mymap); 

// Create Pop-up before calling function for points
function createPopup(feature, layer) {
    var jadeInventory = feature.properties["jades"];
    var jadeList = jadeInventory.split(','); 
    var popup_text = 
        "<b>Palace Name: </b>" + feature.properties["palace_name"] + "<br>" +
        "<b>宮殿名稱: </b>" + feature.properties["宮殿名稱"] + "<br>" +
        "<b>Pinyin: </b>" + feature.properties["pinyin"] + "<br>" +
        "<b>Object Count: </b>" + feature.properties["object_cnt"] + "<br>" +
        "<b>Jade Inventory: </b><ul>";

    for (var i = 0; i < jadeList.length; i++) {
        popup_text += "<li>" + jadeList[i] + "</li>";
    }

    popup_text += "</ul>";

    layer.bindPopup(popup_text);
}

// Color Ramp attributes
function getColor(d) {
 return d <= 5 && d >=1 ? '#fcae91' :
        d <= 10 && d >=6 ? "#fb6a4a" :
        d > 10 ? "#de2d26" :
                      "#fee5d9"; //beige
}

// Create control object
var legend = L.control({position:'bottomright'});

// create function for legend
var categories = ["1-5 Jades", "6-10 Jades", "10 or more Jades"];
var colors = ['#fcae91', '#fb6a4a', '#de2d26'];

legend.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info legend'),
    labels = ['<strong>Legend</strong>'],
    categories = ['1-5 Jades', '6-10 Jades', '10 or more Jades']

    for (var i = 0; i < categories.length; i++) {
        div.innerHTML += 
            '<i style="background:' + colors[i] + '"></i> ' +
            (categories[i] ? categories[i] : '+') + '<br>';
    }

    return div;
};

legend.addTo(mymap);

// Create the Point Layer, bringing in the GeoJSON markers
var points = L.geoJSON(markers, {
    pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, {
            radius: feature.properties["object_cnt"]*5,
            fillColor: getColor(feature.properties["object_cnt"]),
            color: 'white',
            fillOpacity: .5,
            weight: 1
        });
    },
    onEachFeature:createPopup
}).addTo(mymap);

// Add the search control
var searchControl = new L.Control.Search({
  layer: points, // The layer to search
  propertyName: ['jades', 'palace_name', '宮殿名稱'], // Properties to search in GeoJSON
  initial: true, // Whether the search box should be open by default
  zoom: 15, // The zoom level when a result is selected
});

searchControl.on('search:locationfound', function(e) {
  var feature = e.layer.feature;
  if (feature) {
    // Display popup for the found location
    var palaceName = feature.properties["palace_name"];
    var jades = feature.properties["jades"];
    var chineseName = feature.properties["宮殿名稱"];

    var popupText =
      "<b>Palace Name:</b> " + palaceName + "<br>" +
      "<b>Jade Inventory:</b> " + jades + "<br>" +
      "<b>宮殿名稱:</b> " + chineseName;

    e.layer.bindPopup(popupText).openPopup();
  } else {
    // Handle the case where the location is not found
    alert("Location not found.");
  }
}).on('search:collapsed', function(e) {
  // Clear any highlighted results when the search box is collapsed
  points.resetStyle(e.layer);
}).addTo(mymap);





</script>
</body>
</html>